{% extends 'seller_dashboard/components/seller_base.html' %}
{% load static %}
{% block style %}
<style>
    /* صندوق الإحصائيات */
.dashboard-container {
    background-color: #fff;
    padding: 30px;
    border-radius: 10px;
    box-shadow: 0 0 15px rgba(0, 0, 0, 0.1);
}

.dashboard-container h1 {
    color: #333;
    text-align: center;
    margin-bottom: 30px;
}

.stats {
    font-size: 18px;
    line-height: 2;
    color: #555;
}

.stat-item {
    background-color: #f0f0f0;
    margin-bottom: 15px;
    padding: 15px;
    border-radius: 8px;
    font-weight: bold;
}

span {
    color: #074932;
}

/* Charts layout */
.charts-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
    gap: 20px;
    margin-top: 25px;
}

.chart-card {
    background: #fff;
    border-radius: 16px;
    box-shadow: 0 2px 10px rgba(0,0,0,0.05);
    padding: 18px;
}

.chart-card h3 {
    margin-bottom: 10px;
    color: #2c7159a4;
}
</style>
{% endblock %}

{% block title %}Seller Control Panel{% endblock %}
{% block content %}

<div class="main-content">
    <div class="dashboard-container">
        <h1>Seller Control Panel</h1>

        <div class="stats">
            <p class="stat-item">Total Products: <span>{{ total_products }}</span></p>
            <p class="stat-item">Total Orders: <span>{{ total_orders }}</span></p>
            <p class="stat-item">Total Revenue: <span>{{ total_sales }} E.P</span></p>
        </div>

        <div class="charts-grid">
            <div class="chart-card">
                <h3>Revenue (Last 7 Days)</h3>
                <canvas id="salesChart"></canvas>
            </div>
            <div class="chart-card">
                <h3>Quick Overview</h3>
                <canvas id="overviewChart"></canvas>
            </div>
        </div>
    </div>
</div>
<!-- Chart.js -->
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<script>
// Theme colors
const primary = 'rgba(44, 113, 89, 0.65)';
const primarySolid = 'rgba(44, 113, 89, 1)';
const accent = 'rgba(189, 244, 225, 0.65)';

// Sales (Last 7 Days)
fetch('{% url "sales_stats" %}')
  .then(r => r.json())
  .then(({ success }) => {
    const labels = success.map(item => item.date);
    const salesData = success.map(item => item.sales);
    const ctx = document.getElementById('salesChart').getContext('2d');
    new Chart(ctx, {
      type: 'line',
      data: {
        labels,
        datasets: [{
          label: 'Revenue (E.P)',
          data: salesData,
          fill: true,
          backgroundColor: accent,
          borderColor: primarySolid,
          pointBackgroundColor: primarySolid,
          tension: 0.35,
          borderWidth: 2
        }]
      },
      options: {
        responsive: true,
        scales: {
          y: { beginAtZero: true }
        },
        plugins: {
          legend: { labels: { color: '#2c3e50' } }
        }
      }
    });
  })
  .catch(() => {});

// Quick Overview (Products vs Orders)
(function(){
  const ctx2 = document.getElementById('overviewChart').getContext('2d');
  new Chart(ctx2, {
    type: 'bar',
    data: {
      labels: ['Products', 'Orders'],
      datasets: [{
        label: 'Count',
        data: [{{ total_products|default:0 }}, {{ total_orders|default:0 }}],
        backgroundColor: [primary, primary],
        borderColor: [primarySolid, primarySolid],
        borderWidth: 1,
        borderRadius: 8,
      }]
    },
    options: {
      responsive: true,
      scales: {
        y: {
          beginAtZero: true,
          ticks: { precision: 0, stepSize: 1 }
        }
      },
      plugins: { legend: { display: false } }
    }
  });
})();
</script>
{% endblock %}


